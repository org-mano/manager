[Unit]
Description=consul
After=cloudify-iptables-restore.service
Wants=cloudify-iptables-restore.service

[Service]
ExecStart=/opt/consul/consul \
    agent \
    -config-dir /etc/consul.d
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -KILL $MAINPID
Restart=always
RestartSec=10s
LimitNOFILE=40000
User={{ obj.user }}


# consul exits with exit code 1 when it is simply shut down without leaving
# the cluster, which is the usual when eg. bringing it down for maintenance
SuccessExitStatus=0 1 9

[Install]
WantedBy=multi-user.target
