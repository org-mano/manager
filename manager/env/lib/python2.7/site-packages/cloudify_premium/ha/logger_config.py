########
# Copyright (c) 2016 GigaSpaces Technologies Ltd. All rights reserved
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
#    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    * See the License for the specific language governing permissions and
#    * limitations under the License.

"""Logger config.

All cluster-related logs are stored in the file defined by LOGFILE.
Please note that all daemons are run as systemd services, so their stdout
is stored in journald.
For online debugging (when working on the cluster mechanisms), it is more
convenient to use journalctl to view the logs of each service separately.

For offline analysis (when the operator of a cluster needs help fixing
an issue with the cluster), it might be easier for them to only ship the
single logfile (even if it is less pleasant to read than the separate
journald entries).
"""

LOGFILE = '/var/log/cloudify/cloudify-cluster.log'


def make_logger_config(prefix):
    return {
        'version': 1,
        'formatters': {
            'file': {
                'format': (prefix + ' %(asctime)-15s:%(name)s:%(levelname)s:'
                           ' %(message)s')
            },
            'console': {
                'format': '%(name)s:%(levelname)s: %(message)s'
            }
        },
        'handlers': {
            'file': {
                'class': 'logging.FileHandler',
                'formatter': 'file',
                'filename': LOGFILE,
                'level': 'DEBUG'
            },
            'console': {
                'class': 'logging.StreamHandler',
                'stream': 'ext://sys.stdout',
                'formatter': 'console',
                'level': 'DEBUG'
            }
        },
        'loggers': {
            'cloudify_premium.ha': {
                'handlers': ['file', 'console'],
                'propagate': True,
                'level': 'DEBUG'
            },
            'commands': {
                'handlers': ['file', 'console'],
                'propagate': True,
                'level': 'DEBUG'
            }
        }
    }
